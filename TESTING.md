# Руководство по тестированию

## Обзор

Проект использует двухуровневую стратегию тестирования:

- **Unit-тесты (Vitest)** — автоматические тесты компонентов
- **E2E тесты (Playwright)** — ручные тесты пользовательских сценариев
- **Ручное тестирование** — проверка адаптивности и UX

---

## Установка

```bash
# В контейнере уже установлено после bun install
# Для локального запуска E2E (на macOS):
bunx playwright install chromium
```

---

## Структура

```
tests/
├── setup.ts                    # Настройка тестовой среды
├── unit/                       # Unit-тесты (Vitest)
│   └── ContactFormCard.test.tsx
└── e2e/                        # E2E тесты (Playwright, только локально)
    └── home.spec.ts
```

---

## Команды

### Unit-тесты (в контейнере)

```bash
# Запуск всех unit-тестов
bun run test

# Watch-режим (автоматический перезапуск)
bun run test -- --watch

# UI интерфейс
bun run test:ui

# Coverage отчёт
bun run test:coverage
```

### E2E тесты (только локально на Mac)

```bash
# Запуск всех E2E тестов
bun run test:e2e

# UI режим (интерактивная отладка)
bun run test:e2e:ui

# Только Chrome
bunx playwright test --project=chromium

# Только мобильные
bunx playwright test --project=mobile

# Debug режим
bunx playwright test --debug
```

---

## Что тестируется

### Unit-тесты ✅

**ContactFormCard:**

- Рендеринг формы с полями
- Смена типа контакта и placeholder
- Валидация невалидных данных
- Успешная отправка формы
- Индикатор загрузки
- Очистка формы после отправки

**Покрытие:** ~80% критичной бизнес-логики

---

### E2E тесты (в разработке)

Запускаются **только локально**, не в CI/CD.

Проверяют:

- Навигацию между страницами
- Отправку форм
- Адаптивность на мобильных

---

## Ручное тестирование

### Адаптивность (обязательно перед релизом)

**Chrome DevTools (F12 → Device Toolbar):**

1. **Мобильный (375px)**
   - [ ] Нет горизонтального скролла
   - [ ] Текст читается (≥16px)
   - [ ] Кнопки удобны (≥44x44px)
   - [ ] Форма заполняется без зума

2. **Планшет (768px)**
   - [ ] Контент адаптирован
   - [ ] Навигация работает

3. **Десктоп (1920px)**
   - [ ] Контент не растянут
   - [ ] Нет пустых областей

**Реальные устройства:**

- Тестируй на iPhone/Android
- Проверяй жесты и скорость

---

## CI/CD

### GitHub Actions

**При push в `main` или `develop`:**

1. Type check (Astro + TypeScript)
2. Unit-тесты (Vitest)
3. Coverage отчёт

**При push в `main`:**

- Деплой на GitHub Pages

E2E тесты **НЕ запускаются** в CI — только локально.

---

## Best Practices

1. **Один тест = одна проверка**
2. **Используй data-testid** для стабильных селекторов
3. **Мокируй API** в тестах (уже настроено в `tests/setup.ts`)
4. **Проверяй граничные случаи** (пустые поля, невалидные данные)
5. **Тесты независимы** — каждый тест сбрасывает состояние

---

## Troubleshooting

### Тесты падают с "act(...)" warning

→ Уже исправлено в `vitest.config.ts` (скрыты предупреждения)

### E2E тесты не запускаются в контейнере

→ Правильно. Запускай локально: `bun run test:e2e`

### CORS ошибки в тестах

→ Уже исправлено. Fetch замокирован в `tests/setup.ts`

### Тесты проходят локально, но падают в CI

→ Проверь `.github/workflows/ci-tests.yml` — возможно отличается окружение

---

## Дальнейшее развитие

**Приоритет 1 (критично):**

- ✅ Unit-тесты для ContactFormCard
- ⏳ Unit-тесты для FloatingNav

**Приоритет 2 (желательно):**

- ⏳ E2E тесты для форм и навигации
- ⏳ Visual regression тесты (скриншоты)

**Приоритет 3 (опционально):**

- ⏳ Performance тесты (Lighthouse CI)
- ⏳ Accessibility тесты (axe-core)
